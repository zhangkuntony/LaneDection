# 车道检测项目 (Lane Detection)

一个基于Python和OpenCV的车道线检测系统，能够从图像或视频中实时检测车道线，计算车辆相对于车道中心的偏移距离和车道线曲率半径。

## 功能特性

- ✅ **相机标定与畸变校正** - 使用棋盘格进行相机标定，消除镜头畸变
- ✅ **车道线检测与提取** - 结合颜色空间转换和边缘检测技术
- ✅ **透视变换** - 将图像转换为俯视图，便于车道线分析
- ✅ **车道线拟合** - 使用滑动窗口和多项式拟合精确定位车道线
- ✅ **曲率计算** - 计算车道线曲率半径
- ✅ **偏移检测** - 检测车辆相对于车道中心的偏移距离
- ✅ **视频处理** - 支持处理视频文件，实时车道检测

## 项目结构

```
LaneDection/
├── camera_cal/          # 相机标定图像
├── test/               # 测试图像
├── main.py             # 主程序文件
├── requirements.txt    # 依赖包列表
├── project_video.mp4   # 项目测试视频
└── README.md          # 项目说明文档
```

## 安装依赖

```bash
pip install -r requirements.txt
```

### 主要依赖包

- `opencv-python` - 计算机视觉库
- `numpy` - 数值计算库
- `matplotlib` - 数据可视化
- `moviepy` - 视频处理库

## 使用方法

### 1. 基本图像处理

```python
python main.py
```

程序会自动执行以下步骤：
1. 使用`camera_cal/`目录下的图像进行相机标定
2. 对测试图像进行车道检测
3. 显示处理结果

### 2. 自定义参数调整

主要可调整参数：

```python
# 相机标定参数
nx = 9  # 棋盘格横向角点数
ny = 6  # 棋盘格纵向角点数

# 车道检测参数
s_thresh = (170, 255)    # S通道阈值
sx_thresh = (40, 200)    # Sobel边缘检测阈值

# 透视变换参数
perspective_points = [[601, 448], [683, 448], [230, 717], [1097, 717]]
```

### 3. 视频处理

程序支持处理视频文件，自动检测每一帧中的车道线：

```python
# 处理项目视频
clip = VideoFileClip("project_video.mp4")
processed_clip = clip.fl_image(process_image)
processed_clip.write_videofile("output.mp4", audio=False)
```

## 核心算法

### 1. 相机标定
- 使用棋盘格图像进行相机标定
- 计算相机内参矩阵和畸变系数
- 消除镜头畸变影响

### 2. 车道线检测
- **颜色空间转换**: RGB → HLS，提取饱和度和亮度通道
- **边缘检测**: Sobel算子检测水平边缘
- **阈值处理**: 结合颜色和边缘信息进行二值化

### 3. 透视变换
- 将图像转换为鸟瞰图视角
- 便于直线拟合和几何分析
- 设置可调节的偏移参数

### 4. 车道线拟合
- **滑动窗口检测**: 在图像底部确定车道线起始位置
- **多项式拟合**: 使用二次多项式拟合车道线
- **自适应更新**: 根据检测到的像素点动态调整窗口位置

### 5. 几何分析
- **曲率计算**: 将像素坐标转换为真实世界坐标，计算曲率半径
- **偏移检测**: 计算车辆相对于车道中心的偏移距离

## 输出结果

处理后的图像/视频包含以下信息：
- 绿色填充的车道区域
- 车道线曲率半径显示
- 车辆相对于车道中心的偏移距离

## 文件说明

### `main.py` - 主程序
包含所有核心功能函数：
- `calibrate_camera_params()` - 相机标定
- `detect_lane_pixels()` - 车道线像素检测
- `detect_lane_lines()` - 车道线拟合
- `calculate_curvature_radius()` - 曲率计算
- `calculate_center_departure()` - 偏移检测
- `process_image()` - 完整处理流程

### `requirements.txt` - 依赖包
指定项目所需的Python包及版本

## 技术要点

1. **图像预处理**: 畸变校正确保几何准确性
2. **多通道融合**: 结合颜色和边缘信息提高检测鲁棒性
3. **鲁棒拟合**: 滑动窗口机制应对不同光照和道路条件
4. **实时处理**: 优化算法支持视频流实时处理

## 可能的问题与解决方案

### 常见问题
1. **检测失败**: 调整颜色和边缘检测阈值
2. **拟合不准确**: 检查透视变换点设置
3. **性能问题**: 减小图像分辨率或优化算法

### 改进方向
- 添加车道线跟踪算法提高稳定性
- 实现多车道检测
- 添加夜间和恶劣天气适应性
- 集成深度学习模型提高精度

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。
